<ByHowlune>
	<!--Fix holosight dot on hinged weapons. Dot floats in place despite the sight being moved.-->
	<set xpath="/item_modifiers/item_modifier[@name='modGunReflexSight']/item_property_overrides[@name='gunRifleT0PipeRifle']/property[@name='ScopeCameraOffset']/@value">-0.0001,-0.002,.1</set>
	<set xpath="/item_modifiers/item_modifier[@name='modGunReflexSight']/item_property_overrides[@name='gunHandgunT0PipePistol']/property[@name='ScopeCameraOffset']/@value">-0.0002,-.0025,.15</set>
	<append xpath="/item_modifiers/item_modifier[@name='modGunReflexSight']">
		<effect_group name="HoloFix" tiered="false">
			<triggered_effect trigger="onSelfHoldingItemCreated" action="SetTransformActive" active="false" parent_transform="#HeldItemRoot" transform_path="holosight/holosight_dot">
				<requirement name="HoldingItemHasTags" tags="m60,RPK"/>
			</triggered_effect>
			<triggered_effect trigger="onSelfHoldingItemCreated" action="AttachPrefabToHeldItem" prefab="@:Other/Items/Misc/holosight_dot.prefab" local_offset="0,0.038,-0.05555" parent_transform="Handle/Cover">
				<requirement name="HoldingItemHasTags" tags="m60,RPK"/>
			</triggered_effect>
			<triggered_effect trigger="onSelfHoldingItemCreated" action="SetTransformActive" active="false" parent_transform="#HeldItemRoot" transform_path="holosight/holosight_dot">
				<requirement name="HoldingItemHasTags" tags="piperifle"/>
			</triggered_effect>
			<triggered_effect trigger="onSelfHoldingItemCreated" action="AttachPrefabToHeldItem" prefab="@:Other/Items/Misc/holosight_dot.prefab" local_offset="0,0.072,0.02" parent_transform="Handle/Hinge">
				<requirement name="HoldingItemHasTags" tags="piperifle"/>
			</triggered_effect>
			<triggered_effect trigger="onSelfHoldingItemCreated" action="SetTransformActive" active="false" parent_transform="#HeldItemRoot" transform_path="holosight/holosight_dot">
				<requirement name="HoldingItemHasTags" tags="pipepistol"/>
			</triggered_effect>
			<triggered_effect trigger="onSelfHoldingItemCreated" action="AttachPrefabToHeldItem" prefab="@:Other/Items/Misc/holosight_dot.prefab" local_offset="0,0.0835,0.0051" parent_transform="Handle/Hinge">
				<requirement name="HoldingItemHasTags" tags="pipepistol"/>
			</triggered_effect>
		</effect_group>
	</append>
	<!--Other players can see different states of your lights than you have set to. These fix that.-->
	<!--Gunlight Fix-->
	<append xpath="/item_modifiers/item_modifier[@name='modGunFlashlight']">
		<effect_group name="Other" tiered="false">
			<triggered_effect trigger="onSelfEquipStop" action="ModifyCVar" cvar=".Flashlight" operation="set" value="0"/>
			<triggered_effect trigger="onSelfEquipStart" action="ModifyCVar" cvar=".Flashlight" operation="set" value="1">
				<requirement name="IsItemActive"/>
			</triggered_effect>
			<triggered_effect trigger="onSelfItemActivate" action="ModifyCVar" cvar=".Flashlight" operation="set" value="1"/>
			<triggered_effect trigger="onSelfItemDeactivate" action="ModifyCVar" cvar=".Flashlight" operation="set" value="0"/>
			<triggered_effect trigger="onSelfItemActivate" action="PlaySound" sound="light_on" play_in_head="true"/>
			<triggered_effect trigger="onSelfItemDeactivate" action="PlaySound" sound="light_off" play_in_head="true"/>
			<triggered_effect trigger="onSelfWalk" action="SetTransformActive" active="false" transform_path="lightSource">
				<requirement name="CVarCompare" cvar=".Flashlight" operation="Equals" value="0"/>
			</triggered_effect>
			<triggered_effect trigger="onSelfWalk" action="SetTransformActive" active="false" transform_path="flashlight_lightSource">
				<requirement name="CVarCompare" cvar=".Flashlight" operation="Equals" value="0"/>
			</triggered_effect>
			<triggered_effect trigger="onSelfWalk" action="SetTransformActive" active="true" transform_path="lightSource">
				<requirement name="CVarCompare" cvar=".Flashlight" operation="Equals" value="1"/>
			</triggered_effect>
			<triggered_effect trigger="onSelfWalk" action="SetTransformActive" active="true" transform_path="flashlight_lightSource">
				<requirement name="CVarCompare" cvar=".Flashlight" operation="Equals" value="1"/>
			</triggered_effect>
		</effect_group>
	</append>
	<!--Helmet Light Fix-->
	<set xpath="/item_modifiers/item_modifier[@name='modArmorHelmetLight']/effect_group[1]">
		<triggered_effect trigger="onSelfEquipStop" action="ModifyCVar" cvar=".HelmLight" operation="set" value="0"/>
		<triggered_effect trigger="onSelfEquipStart" action="ModifyCVar" cvar=".HelmLight" operation="set" value="1">
			<requirement name="IsItemActive"/>
		</triggered_effect>
		<triggered_effect trigger="onSelfItemActivate" action="ModifyCVar" cvar=".HelmLight" operation="set" value="1"/>
		<triggered_effect trigger="onSelfItemDeactivate" action="ModifyCVar" cvar=".HelmLight" operation="set" value="0"/>
		<triggered_effect trigger="onSelfItemActivate" action="PlaySound" sound="light_on" play_in_head="true"/>
		<triggered_effect trigger="onSelfItemDeactivate" action="PlaySound" sound="light_off" play_in_head="true"/>
		<triggered_effect trigger="onSelfItemDeactivate" action="RemovePart" part="HeadLight"/>
		<triggered_effect trigger="onSelfItemDeactivate" action="RemovePart" part="HeadLightCam"/>
		<triggered_effect trigger="onSelfItemActivate" action="AddPart" part="HeadLight" prefab="Entities/Lighting/miningHelmetLightSource" parentTransform="Spotlight" localPos="0,0,0" localRot="90,0,0"/>
		<triggered_effect trigger="onSelfItemActivate" action="AddPart" part="HeadLightCam" prefab="Entities/Lighting/miningHelmetLightSource" parentTransform="CameraNode" localPos="0,0,0" localRot="-90,0,0"/>
		<triggered_effect trigger="onSelfItemActivate" action="SetPartActive" part="HeadLight" active="@!.IsFPV"/>
		<triggered_effect trigger="onSelfItemActivate" action="SetPartActive" part="HeadLightCam" active="@.IsFPV"/>
	</set>
	<append xpath="/item_modifiers/item_modifier[@name='modArmorHelmetLight']">
		<effect_group name="LightFix" tiered="false">
			<triggered_effect trigger="onSelfWalk" action="RemovePart" part="HeadLight">
				<requirement name="CVarCompare" cvar=".HelmLight" operation="Equals" value="0"/>
			</triggered_effect>
			<triggered_effect trigger="onSelfWalk" action="RemovePart" part="HeadLightCam">
				<requirement name="CVarCompare" cvar=".HelmLight" operation="Equals" value="0"/>
			</triggered_effect>
			<triggered_effect trigger="onSelfWalk" action="AddPart" part="HeadLight" prefab="Entities/Lighting/miningHelmetLightSource" parentTransform="Spotlight" localPos="0,0,0" localRot="90,0,0">
				<requirement name="CVarCompare" cvar=".HelmLight" operation="Equals" value="1"/>
			</triggered_effect>
			<triggered_effect trigger="onSelfWalk" action="AddPart" part="HeadLightCam" prefab="Entities/Lighting/miningHelmetLightSource" parentTransform="CameraNode" localPos="0,0,0" localRot="-90,0,0">
				<requirement name="CVarCompare" cvar=".HelmLight" operation="Equals" value="1"/>
			</triggered_effect>
		</effect_group>
	</append>
</ByHowlune>